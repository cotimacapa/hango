{% extends 'base.html' %}
{% load i18n %}
{% block title %}{% trans "Orders" %} - Hango{% endblock %}

{% block content %}
  <h1 class="title">{% trans "Orders" %}</h1>
  <p class="subtitle">{% trans "Daily list of delivered/undelivered orders." %}</p>

  <form method="get" class="box mb-5" role="search" aria-label="{% trans 'Filter by date' %}">
    <div class="field is-grouped is-align-items-center">
      <div class="control">
        <label for="date" class="label is-small">{% trans "Select date" %}</label>
        <input id="date" name="date" type="date" class="input"
               value="{{ selected_date|date:'Y-m-d' }}" />
      </div>
      <div class="control mt-5-mobile">
        <button type="submit" class="button is-info mt-4">{% trans "Filter" %}</button>
      </div>
    </div>
  </form>

  <div class="box">
    <div class="table-container">
      <table class="table is-fullwidth is-striped is-hoverable">
        <thead>
          <tr>
            <th>ID</th>
            <th>{% trans "When" %}</th>
            <th>{% trans "Student" %}</th>
            <th>{% trans "Items" %}</th>
            <th>{% trans "Status" %}</th>
          </tr>
        </thead>
        <tbody>
          {% if orders %}
            {% for o in orders %}
              <tr>
                <td>#{{ o.id }}</td>
                <td>{{ o.created_at|timesince }} {% trans "ago" %}</td>
                <td>{{ o.user.get_full_name|default:o.user.username }}</td>
                <td>
                  {% for line in o.lines.all %}
                    <span class="tag is-light">{{ line.qty }}× {{ line.item.name }}</span>
                  {% empty %}
                    <span class="has-text-grey">—</span>
                  {% endfor %}
                </td>
                <td>
                  {% if o.delivery_status == 'delivered' %}
                    <span class="tag is-success">{% trans "Delivered" %}</span>
                  {% elif o.delivery_status == 'undelivered' %}
                    <span class="tag is-warning">{% trans "Undelivered" %}</span>
                  {% else %}
                    <span class="tag is-light">–</span>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="5" class="has-text-centered has-text-grey">
                {% trans "No orders for this date." %}
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
