{% extends 'base.html' %}
{% load static i18n %}
{% load i18n %}
{% block title %}{% trans "Kitchen Board" %} - Hango{% endblock %}
{% block content %}

<!-- Auto-refresh every 10s -->
<script>setTimeout(function(){ location.reload(); }, 10000);</script>

<h1 class="title">{% trans "Kitchen Board" %}</h1>
<p class="subtitle">{% trans "Today’s pending orders. Auto-refreshes every 10 seconds." %}</p>

<div class="box">
  {% if orders %}
    <div class="table-container">
      <table class="table is-fullwidth is-striped is-hoverable">
        <thead>
          <tr>
            <th>ID</th>
            <th>{% trans "When" %}</th>
            <th>{% trans "Student" %}</th>
            <th>{% trans "Items" %}</th>
            <th class="has-text-right">{% trans "Actions" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for o in orders %}
            <tr>
              <td>#{{ o.id }}</td>
              <td title="{{ o.created_at }}">{{ o.created_at|timesince }} {% trans "ago" %}</td>
              <td>{{ o.user.get_full_name|default:o.user.username }}</td>
              <td>
                {% for li in o.lines.all %}
                  <span class="tag is-light mb-1">{{ li.qty }}× {{ li.item.name }}</span>
                {% empty %}
                  <span class="has-text-grey">—</span>
                {% endfor %}
              </td>
              <td class="has-text-right">
                {% if request.user.is_staff %}
                  <div class="buttons are-small is-right">
                    <!-- Green ✓ = delivered -->
                    <form method="post" action="{% url 'orders:deliver' o.id 'delivered' %}" class="is-inline-block">
                      {% csrf_token %}
                      <button type="submit" class="button is-success"
                              title="{% trans 'Mark as delivered' %}"
                              aria-label="{% trans 'Mark as delivered' %}">
                        ✓ {% trans "Delivered" %}
                      </button>
                    </form>
                    <!-- Yellow ⚠ = undelivered -->
                    <form method="post" action="{% url 'orders:deliver' o.id 'undelivered' %}" class="is-inline-block ml-2">
                      {% csrf_token %}
                      <button type="submit" class="button is-warning"
                              title="{% trans 'Mark as undelivered' %}"
                              aria-label="{% trans 'Mark as undelivered' %}">
                        ⚠ {% trans "Undelivered" %}
                      </button>
                    </form>
                  </div>
                {% else %}
                  <span class="has-text-grey">—</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="has-text-grey">{% trans "No pending orders for today." %}</p>
  {% endif %}
</div>

<div class="buttons">
  <a class="button" href="{% url 'orders:list' %}">
    {% trans "Go to Orders (today)" %}
  </a>
</div>

{% endblock %}
