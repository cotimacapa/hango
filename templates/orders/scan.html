{% extends "base.html" %}

{% block title %}Leitura de c√≥digo ‚Äî Hango{% endblock %}

{% block content %}
  <h1 class="title is-4">Leitura de c√≥digo</h1>
  <p class="subtitle is-6">Aponte o leitor para o c√≥digo do aluno. O campo abaixo mant√©m foco autom√°tico.</p>

  <form method="post" class="field is-grouped">
    {% csrf_token %}
    <div class="control is-expanded">
      {# IMPORTANT: no pattern here; scanners may send CR/LF; server validates EAN-13 #}
      <input class="input is-medium" type="text" name="token"
             inputmode="numeric" maxlength="32" autofocus
             placeholder="Digite/escaneie o c√≥digo" autocomplete="off">
    </div>
    <div class="control">
      <button class="button is-medium is-link" type="submit">Confirmar</button>
    </div>
  </form>

  {% if result %}
    {% if result == "ok" %}
      <article class="message is-success">
        <div class="message-body">
          ‚úÖ Entregue para <strong>{{ order.user.get_full_name|default:order.user }}</strong>.
          <br>Pedido <strong>#{{ order.id }}</strong> ‚Äî Token <code>{{ order.pickup_token }}</code> ‚Äî Dia {{ order.service_day|date:"d/m/Y" }}.
        </div>
      </article>
    {% elif result == "already" %}
      <article class="message is-warning">
        <div class="message-body">
          ‚ÑπÔ∏è Este pedido j√° foi entregue. {{ message }}
          <br>Pedido <strong>#{{ order.id }}</strong> ‚Äî Token <code>{{ order.pickup_token }}</code>.
        </div>
      </article>
    {% elif result == "wrongday" %}
      <article class="message is-warning">
        <div class="message-body">
          ‚ö†Ô∏è C√≥digo v√°lido, mas n√£o √© de hoje. {{ message }}
          <br>Pedido <strong>#{{ order.id }}</strong> ‚Äî Token <code>{{ order.pickup_token }}</code>.
        </div>
      </article>
    {% elif result == "notfound" %}
      <article class="message is-danger">
        <div class="message-body">‚ùå Token n√£o encontrado.</div>
      </article>
    {% else %}
      <article class="message is-danger">
        <div class="message-body">‚ùå {{ error }}</div>
      </article>
    {% endif %}
  {% endif %}

  <!-- <div class="buttons mt-2">
    <a class="button" href="{% url 'orders:list' %}">‚¨Ö Pedidos</a>
    <a class="button" href="{% url 'orders:kitchen' %}">üçΩ Cozinha</a>
  </div> -->
{% endblock %}
